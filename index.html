<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lamp Pull Effect</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="lamp-container">
        <div class="lamp"></div>
        <div class="bulb"></div>
        <div class="string"></div>
        <div class="light"></div>
    </div>
<script>
    const rope = document.querySelector('.string');
    const bulb = document.querySelector('.bulb');
    const lampContainer = document.getElementById('lamp-container');

    let isDragging = false;
    let currentAngle = 0;
    let currentStretch = 1;
    let velocityAngle = 0;
    let velocityStretch = 0;

    let lastX = 0, lastY = 0;
    let centerX = window.innerWidth / 2;
    let centerY = 100;

    function getPosition(e) {
        return { x: e.clientX, y: e.clientY };
    }

    function startDrag(e) {
        isDragging = true;
        const pos = getPosition(e);
        lastX = pos.x;
        lastY = pos.y;
    }

    function onMove(e) {
        if (!isDragging) return;

        const pos = getPosition(e);
        const dx = pos.x - centerX;
        const dy = pos.y - centerY;

        // Angle calc
        let angle = Math.atan2(dy, dx) * (180 / Math.PI) - 90;
        angle = Math.max(-60, Math.min(60, angle));

        // Stretch calc
        let stretch = 1 + Math.max(0, dy / 150); // more sensitive
        stretch = Math.min(2.2, stretch); // allow up to 220% length


        // Calculate velocity based on movement speed
        let deltaX = pos.x - lastX;
        let deltaY = pos.y - lastY;

        velocityAngle = deltaX * 0.2;    // horizontal flick adds angle velocity
        velocityStretch = deltaY * 0.015; // vertical flick adds stretch velocity

        lastX = pos.x;
        lastY = pos.y;

        currentAngle = angle;
        currentStretch = stretch;

        applyTransform();
    }

    function endDrag() {
        if (!isDragging) return;
        isDragging = false;

        let angleSpring = 0.07;
        let stretchSpring = 0.25;
        let damping = 0.88;

        function animate() {
            // Swing effect
            let angleForce = (0 - currentAngle) * angleSpring;
            velocityAngle += angleForce;
            velocityAngle *= damping;
            currentAngle += velocityAngle;

            // Bounce effect
            let stretchForce = (1 - currentStretch) * stretchSpring;
            velocityStretch += stretchForce;
            velocityStretch *= damping;
            currentStretch += velocityStretch;

            applyTransform();

            if (Math.abs(velocityAngle) > 0.01 || Math.abs(velocityStretch) > 0.01) {
                requestAnimationFrame(animate);
            } else {
                currentAngle = 0;
                currentStretch = 1;
                applyTransform();
            }
        }
        animate();

        if (currentStretch > 1.2) {
            lampContainer.classList.toggle('on');
        }
    }

    function applyTransform() {
        rope.style.transform = `translateX(30px) rotate(${currentAngle}deg) scaleY(${currentStretch})`;
        bulb.style.transform = `translateX(-50%) rotate(${currentAngle}deg)`;
    }

    rope.addEventListener('pointerdown', startDrag);
    document.addEventListener('pointermove', onMove);
    document.addEventListener('pointerup', endDrag);
</script>


</body>

</html>