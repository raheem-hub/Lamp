<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lamp Pull Effect</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="lamp-container">
        <div class="lamp"></div>
        <div class="bulb"></div>
        <div class="string"></div>
        <div class="light"></div>
    </div>

    <script>
        const rope = document.querySelector('.string');
        const bulb = document.querySelector('.bulb');
        const light = document.querySelector('.light');
        const lampContainer = document.getElementById('lamp-container');

        let isDragging = false;
        let startX, startY;
        let currentAngle = 0;
        let currentStretch = 1;
        let velocityAngle = 0;
        let velocityStretch = 0;
        let centerX = window.innerWidth / 2;
        let centerY = 100; // top pivot

        // Mouse down to start pulling
        rope.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            const dx = e.clientX - centerX;
            const dy = e.clientY - centerY;

            // Correct angle calculation
            let angle = Math.atan2(dy, dx) * (180 / Math.PI) - 90;

            if (angle > 60) angle = 60;
            if (angle < -60) angle = -60;

            // Stretch when pulling down
            let stretch = 1 + Math.max(0, dy / 200);
            if (stretch > 1.4) stretch = 1.4;

            currentAngle = angle;
            currentStretch = stretch;

            applyTransform();
        });

        document.addEventListener('mouseup', () => {
            if (!isDragging) return;
            isDragging = false;

            // Animate back to normal using elastic effect
            function animate() {
                // Spring physics
                velocityAngle += (0 - currentAngle) * 0.08;
                velocityAngle *= 0.85;
                currentAngle += velocityAngle;

                velocityStretch += (1 - currentStretch) * 0.15;
                velocityStretch *= 0.75;
                currentStretch += velocityStretch;

                applyTransform();

                if (Math.abs(currentAngle) > 0.2 || Math.abs(currentStretch - 1) > 0.01) {
                    requestAnimationFrame(animate);
                } else {
                    currentAngle = 0;
                    currentStretch = 1;
                    applyTransform();
                }
            }
            animate();

            // Toggle lamp if pulled down enough
            if (currentStretch > 1.2) {
                lampContainer.classList.toggle('on');
            }
        });

        function applyTransform() {
            rope.style.transform = `rotate(${currentAngle}deg) scaleY(${currentStretch})`;
            bulb.style.transform = `translateX(-50%) rotate(${currentAngle}deg)`;
        }
    </script>
</body>

</html>